#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <openssl/rc4.h>
#include <fcntl.h>


const char key[] = "I_am_w3LL_h1dd3n";

const unsigned char shellcode[] = {
  0xeb, 0x00, 0x48, 0x81, 0xec, 0xfe, 0x00, 0x00, 0x00, 0x48, 0x31, 0xf6,
  0x48, 0x31, 0xff, 0x48, 0x31, 0xc0, 0x48, 0xb8, 0x66, 0x6c, 0x61, 0x67,
  0x2e, 0x74, 0x78, 0x74, 0x50, 0x48, 0x8d, 0x3c, 0x24, 0xb8, 0x02, 0x00,
  0x00, 0x00, 0x0f, 0x05, 0x48, 0x83, 0xf8, 0x00, 0x0f, 0x8e, 0xc1, 0x00,
  0x00, 0x00, 0x50, 0xba, 0x20, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x74, 0x24,
  0x10, 0x48, 0x8b, 0x3c, 0x24, 0xb8, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x05,
  0x48, 0x83, 0xf8, 0x00, 0x0f, 0x8e, 0x95, 0x00, 0x00, 0x00, 0x48, 0x89,
  0xc3, 0x48, 0x31, 0xd2, 0x48, 0x39, 0xda, 0x7f, 0x24, 0x48, 0x0f, 0xb6,
  0x44, 0x14, 0x10, 0x41, 0x88, 0xd0, 0x41, 0xf6, 0xc0, 0x01, 0x75, 0x10,
  0x48, 0xd1, 0xc0, 0x48, 0x83, 0xf0, 0x33, 0x88, 0x44, 0x14, 0x10, 0x48,
  0xff, 0xc2, 0xeb, 0xdc, 0x48, 0xd1, 0xc8, 0xeb, 0xee, 0x48, 0x31, 0xd2,
  0xbe, 0x01, 0x00, 0x00, 0x00, 0xbf, 0x02, 0x00, 0x00, 0x00, 0xb8, 0x29,
  0x00, 0x00, 0x00, 0x0f, 0x05, 0x88, 0x44, 0x24, 0x04, 0xc6, 0x44, 0x24,
  0x38, 0x02, 0x66, 0xc7, 0x44, 0x24, 0x3a, 0x05, 0x39, 0x66, 0xc7, 0x44,
  0x24, 0x3c, 0x7f, 0x01, 0xba, 0x10, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x74,
  0x24, 0x38, 0x48, 0x0f, 0xb6, 0x7c, 0x24, 0x04, 0xb8, 0x2a, 0x00, 0x00,
  0x00, 0x0f, 0x05, 0x48, 0x83, 0xf8, 0x00, 0x75, 0x11, 0x48, 0x89, 0xda,
  0x48, 0x8d, 0x74, 0x24, 0x10, 0xb8, 0x01, 0x00, 0x00, 0x00, 0x0f, 0x05,
  0xeb, 0x00, 0x48, 0x0f, 0xb6, 0x7c, 0x24, 0x04, 0xb8, 0x03, 0x00, 0x00,
  0x00, 0x0f, 0x05, 0x48, 0x0f, 0xb6, 0x3c, 0x24, 0xb8, 0x03, 0x00, 0x00,
  0x00, 0x0f, 0x05, 0x48, 0x31, 0xff, 0x48, 0x31, 0xc0, 0xb8, 0x3c, 0x00,
  0x00, 0x00, 0x0f, 0x05
};

int main(int argc, char **argv){
		RC4_KEY rc4Key;
		unsigned char* encryptedShellcode = (unsigned char*)malloc(sizeof(shellcode));
		int fd = open("encrypted_shellcode",2);

		RC4_set_key(&rc4Key, 16, key);
		RC4(&rc4Key, sizeof(shellcode), shellcode, encryptedShellcode);
		write(fd, encryptedShellcode, sizeof(shellcode));
		close(fd);
}
